<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å‡ºå‹¤é»åçµ±è¨ˆ</title>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; padding: 20px; background: #f6f6f6; }
    table { border-collapse: collapse; width: 100%; background: white; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    input[type="time"], input[type="text"] { width: 100px; padding: 2px; }
    button { margin-top: 15px; padding: 8px 16px; cursor: pointer; }
    #result { margin-top: 20px; background: #fff; border: 1px solid #ccc; padding: 10px; white-space: pre-line; }
    .flex { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>å‡ºå‹¤é»åç³»çµ±</h2>

  <div class="flex">
    <label>æ—¥æœŸï¼š</label>
    <input type="date" id="datePicker">
  </div>

  <div class="flex">
    <input type="text" id="nameInput" placeholder="è¼¸å…¥åå–®ï¼Œç”¨é€—è™Ÿåˆ†éš” (ä¾‹ï¼šA,B,C,D)" style="width:300px;">
    <button onclick="setNames()">å»ºç«‹åå–®</button>
  </div>

  <table id="attendanceTable">
    <thead>
      <tr>
        <th>å§“å</th>
        <th>å‡ºå‹¤ç‹€æ…‹</th>
        <th>åœ°é»ï¼æœŸé–“ï¼ˆè‹¥æœ‰ï¼‰</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button onclick="generateResult()">å½™æ•´çµæœ</button>
  <button onclick="copyResult()">ğŸ“‹ ä¸€éµè¤‡è£½</button>

  <div id="result"></div>

  <script>
    // åˆå§‹åŒ–
    window.onload = function() {
      const savedNames = localStorage.getItem("names");
      if (savedNames) {
        document.getElementById("nameInput").value = savedNames;
        buildTable(savedNames.split(","));
      }
      document.getElementById("datePicker").valueAsDate = new Date();
    };

    // å„²å­˜åå–®ä¸¦ç”Ÿæˆè¡¨æ ¼
    function setNames() {
      const nameStr = document.getElementById("nameInput").value.trim();
      if (!nameStr) return alert("è«‹è¼¸å…¥åå–®");
      localStorage.setItem("names", nameStr);
      buildTable(nameStr.split(","));
    }

    // å»ºç«‹è¡¨æ ¼
    function buildTable(names) {
      const tbody = document.querySelector("#attendanceTable tbody");
      tbody.innerHTML = "";
      names.forEach(name => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${name.trim()}</td>
          <td>
            <select>
              <option value="åœ¨ç‡Ÿ">åœ¨ç‡Ÿ</option>
              <option value="ä¼‘å‡">ä¼‘å‡</option>
              <option value="å…¬å‹¤">å…¬å‹¤</option>
              <option value="å—è¨“">å—è¨“</option>
            </select>
          </td>
          <td><input type="text" placeholder="åœ°é»æˆ–æ™‚é–“å€é–“"></td>
        `;
        tbody.appendChild(tr);
      });
    }

    // å½™æ•´çµæœ
    function generateResult() {
      const date = document.getElementById("datePicker").value;
      const rows = document.querySelectorAll("#attendanceTable tbody tr");
      let zaiying = [], xiujia = [], gongqin = [], shouxun = [];

      rows.forEach(r => {
        const name = r.children[0].textContent.trim();
        const status = r.children[1].querySelector("select").value;
        const note = r.children[2].querySelector("input").value.trim();

        if (status === "åœ¨ç‡Ÿ") zaiying.push(name);
        else if (status === "ä¼‘å‡") xiujia.push(name);
        else if (status === "å…¬å‹¤") gongqin.push(name + (note ? `(${note})` : ""));
        else if (status === "å—è¨“") shouxun.push(name + (note ? `(${note})` : ""));
      });

      const total = zaiying.length + xiujia.length + gongqin.length + shouxun.length;
      let result = `å°ˆæ¡ˆä½œæ¥­${formatDate(date)}å‡ºå‹¤çµ±è¨ˆï¼š
æ‡‰åˆ°${total}ã€äº‹æ•…${xiujia.length + gongqin.length + shouxun.length}ã€å¯¦åˆ°${zaiying.length}
åœ¨ç‡Ÿ(${zaiying.length})ï¼š${zaiying.join("ã€") || "ç„¡"}

äº‹æ•…(${xiujia.length + gongqin.length + shouxun.length})ï¼š
`;

      // ğŸ”¢ è‡ªå‹•éæ¸›ç·¨è™Ÿé‚è¼¯
      let count = 1;
      if (xiujia.length) {
        result += `${count++}.ä¼‘å‡ï¼š${xiujia.join("ã€")}\n`;
      }
      if (shouxun.length) {
        result += `${count++}.å—è¨“ï¼š${shouxun.join("ã€")}\n`;
      }
      if (gongqin.length) {
        result += `${count++}.å…¬å‹¤ï¼š${gongqin.join("ã€")}\n`;
      }

      document.getElementById("result").textContent = result.trim();
    }

    // ä¸€éµè¤‡è£½
    function copyResult() {
      const text = document.getElementById("result").textContent;
      if (!text) return alert("è«‹å…ˆç”¢ç”Ÿçµæœï¼");
      navigator.clipboard.writeText(text);
      alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
    }

    // æ—¥æœŸæ ¼å¼åŒ–
    function formatDate(dateStr) {
      if (!dateStr) return "";
      const date = new Date(dateStr);
      return `${date.getMonth()+1}æœˆ${date.getDate()}æ—¥`;
    }
  </script>
</body>
</html>
