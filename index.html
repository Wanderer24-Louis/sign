<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å‡ºå‹¤çµ±è¨ˆç³»çµ±</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      padding: 20px;
      background: #f8f8f8;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    th {
      background-color: #eee;
    }
    input[type="date"], input[type="text"], input[type="number"] {
      padding: 4px;
      width: 150px;
    }
    .small-input {
      width: 100px;
    }
    button {
      margin-top: 15px;
      padding: 8px 16px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      background: #4CAF50;
      color: white;
      font-size: 14px;
    }
    button:hover {
      background: #45a049;
    }
    #result {
      margin-top: 20px;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <h2>å°ˆæ¡ˆä½œæ¥­å‡ºå‹¤çµ±è¨ˆ</h2>

  <label>æ—¥æœŸï¼š</label>
  <input type="date" id="datePicker"><br><br>

  <label>æ‡‰åˆ°äººæ•¸ï¼š</label>
  <input type="number" id="shouldAttend" value="10" min="0"><br><br>

  <table>
    <tr>
      <th>å§“å</th>
      <th>åœ¨ç‡Ÿ</th>
      <th>ä¼‘å‡</th>
      <th>å—è¨“</th>
      <th>å…¬å‹¤</th>
      <th>åœ°é»</th>
      <th>èµ·</th>
      <th>è¿„</th>
    </tr>

    <!-- åå–®ç¯„ä¾‹ï¼Œå¯è‡ªè¡Œå¢åŠ  -->
    <tr><td>A</td><td><input type="checkbox" name="A" value="åœ¨ç‡Ÿ"></td><td><input type="checkbox" name="A" value="ä¼‘å‡"></td><td><input type="checkbox" name="A" value="å—è¨“"></td><td><input type="checkbox" name="A" value="å…¬å‹¤"></td><td><input type="text" class="place small-input"></td><td><input type="text" class="from small-input"></td><td><input type="text" class="to small-input"></td></tr>
    <tr><td>B</td><td><input type="checkbox" name="B" value="åœ¨ç‡Ÿ"></td><td><input type="checkbox" name="B" value="ä¼‘å‡"></td><td><input type="checkbox" name="B" value="å—è¨“"></td><td><input type="checkbox" name="B" value="å…¬å‹¤"></td><td><input type="text" class="place small-input"></td><td><input type="text" class="from small-input"></td><td><input type="text" class="to small-input"></td></tr>
    <tr><td>C</td><td><input type="checkbox" name="C" value="åœ¨ç‡Ÿ"></td><td><input type="checkbox" name="C" value="ä¼‘å‡"></td><td><input type="checkbox" name="C" value="å—è¨“"></td><td><input type="checkbox" name="C" value="å…¬å‹¤"></td><td><input type="text" class="place small-input"></td><td><input type="text" class="from small-input"></td><td><input type="text" class="to small-input"></td></tr>
    <tr><td>D</td><td><input type="checkbox" name="D" value="åœ¨ç‡Ÿ"></td><td><input type="checkbox" name="D" value="ä¼‘å‡"></td><td><input type="checkbox" name="D" value="å—è¨“"></td><td><input type="checkbox" name="D" value="å…¬å‹¤"></td><td><input type="text" class="place small-input"></td><td><input type="text" class="from small-input"></td><td><input type="text" class="to small-input"></td></tr>
    <tr><td>E</td><td><input type="checkbox" name="E" value="åœ¨ç‡Ÿ"></td><td><input type="checkbox" name="E" value="ä¼‘å‡"></td><td><input type="checkbox" name="E" value="å—è¨“"></td><td><input type="checkbox" name="E" value="å…¬å‹¤"></td><td><input type="text" class="place small-input"></td><td><input type="text" class="from small-input"></td><td><input type="text" class="to small-input"></td></tr>
    <tr><td>F</td><td><input type="checkbox" name="F" value="åœ¨ç‡Ÿ"></td><td><input type="checkbox" name="F" value="ä¼‘å‡"></td><td><input type="checkbox" name="F" value="å—è¨“"></td><td><input type="checkbox" name="F" value="å…¬å‹¤"></td><td><input type="text" class="place small-input"></td><td><input type="text" class="from small-input"></td><td><input type="text" class="to small-input"></td></tr>
    <tr><td>G</td><td><input type="checkbox" name="G" value="åœ¨ç‡Ÿ"></td><td><input type="checkbox" name="G" value="ä¼‘å‡"></td><td><input type="checkbox" name="G" value="å—è¨“"></td><td><input type="checkbox" name="G" value="å…¬å‹¤"></td><td><input type="text" class="place small-input"></td><td><input type="text" class="from small-input"></td><td><input type="text" class="to small-input"></td></tr>
  </table>

  <button onclick="generateReport()">å½™æ•´çµæœ</button>
  <button onclick="copyResult()">ğŸ“‹ ä¸€éµè¤‡è£½</button>

  <div id="result"></div>

  <script>
    // è‡ªå‹•å¸¶å…¥ä»Šå¤©æ—¥æœŸ
    document.addEventListener("DOMContentLoaded", () => {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      document.getElementById("datePicker").value = `${yyyy}-${mm}-${dd}`;
    });

    function formatDateForDisplay(dateStr) {
      if (!dateStr) return "";
      const date = new Date(dateStr);
      if (isNaN(date)) return dateStr;
      return `${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
    }

    function generateReport() {
      const dateStr = document.getElementById("datePicker").value;
      const dateText = formatDateForDisplay(dateStr) || "ï¼ˆæœªå¡«æ—¥æœŸï¼‰";
      const shouldAttend = parseInt(document.getElementById("shouldAttend").value) || 0;

      const rows = document.querySelectorAll("table tr");
      let presentList = [];
      let leaveList = { "ä¼‘å‡": [], "å—è¨“": [], "å…¬å‹¤": [] };

      rows.forEach((row, i) => {
        if (i === 0) return;
        const name = row.cells[0].textContent.trim();
        const checks = row.querySelectorAll('input[type="checkbox"]:checked');
        const place = row.querySelector('.place').value.trim();
        const from = row.querySelector('.from').value.trim();
        const to = row.querySelector('.to').value.trim();

        if (checks.length === 0) return;

        checks.forEach(cb => {
          const val = cb.value;
          if (val === "åœ¨ç‡Ÿ") {
            presentList.push(name);
          } else if (val === "ä¼‘å‡" || val === "å—è¨“" || val === "å…¬å‹¤") {
            let extra = "";
            if (val === "å…¬å‹¤" && place) extra += `ï¼ˆ${place}`;
            if (from && to) extra += `${place ? " " : "ï¼ˆ"}${from}-${to}ï¼‰`;
            else if (place && !from && !to) extra += "ï¼‰";
            else if (!place && from && to) extra += `ï¼ˆ${from}-${to}ï¼‰`;
            leaveList[val].push(`${name}${extra}`);
          }
        });
      });

      const totalPresent = presentList.length;
      const totalLeave = shouldAttend - totalPresent;

      let report = `å°ˆæ¡ˆä½œæ¥­${dateText}å‡ºå‹¤çµ±è¨ˆï¼š\n`;
      report += `æ‡‰åˆ°${shouldAttend}ã€äº‹æ•…${totalLeave}ã€å¯¦åˆ°${totalPresent}\n`;
      report += `åœ¨ç‡Ÿ(${totalPresent})ï¼š${presentList.join("ã€")}\n\n`;

      report += `äº‹æ•…(${totalLeave})ï¼š\n`;
      let idx = 1;
      for (let type of ["ä¼‘å‡", "å—è¨“", "å…¬å‹¤"]) {
        if (leaveList[type].length > 0) {
          report += `${idx}.${type}ï¼š${leaveList[type].join("ã€")}\n`;
          idx++;
        }
      }

      document.getElementById("result").textContent = report;
    }

    function copyResult() {
      const result = document.getElementById("result").textContent;
      if (!result.trim()) {
        alert("è«‹å…ˆç”¢ç”Ÿå‡ºå‹¤çµ±è¨ˆå†è¤‡è£½ï¼");
        return;
      }
      navigator.clipboard.writeText(result).then(() => {
        alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼");
      });
    }
  </script>
</body>
</html>
